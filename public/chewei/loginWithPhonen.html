<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<link rel="stylesheet" href="css/all.css" />
		<link rel="stylesheet" href="css/login.css" />
		<script type="text/javascript" src="js/jquery.1.9.1.js"></script>
		<script type="text/javascript" src="js/jquery.validate.min.js"></script>
		<script type="text/javascript" src="js/cookieFunction.js"></script>
		<script type="text/javascript" src="js/md5.js"></script>
		<title>登陆</title>
		<style>
			label.error {
				font-size: 14px;
				display: inline-block;
				*display: inline;
				zoom: 1;
			}
		</style>

	</head>

	<body>
		<!--记录数据-->
		<div id="fileName" fileNam="login"></div>
		<!--记录数据-->
		<img class="bg" src="img/login_bg.jpg" />
		<div id="loginContainer">
			<div class="loginWelcom">车位共享平台</div>
			<form action="/login" method="post" id='loginform' name='loginform'>
                <div>
                    <a>帐号类型:</a>
                    <select id="loginType"><option selected="selected" value="system">系统管理员</option>
                        <option value="changshang">厂商管理员</option>
                        <option value="xiaoqu">小区管理员</option>
                        <option value="user">一般用户</option>
                    </select>                    
                </div>

				<div class="inputDiv">
					<div class="loginIcon"><img src="img/login_name.png" /></div>
					<input id="phoneNum" class="loginInput" placeholder="手机号" type="text" name="phoneNum" />

					<div class="small">请输入账号</div>
				</div>

				<div class="inputDiv">
					<div class="loginIcon"><img src="img/login_pwd.png" /></div>
					<input id="verCode" class="loginInput" placeholder="验证码" type="text" name="verCode" />
					<div class="small">请输入密码</div>
				</div>
				<div class="loginRegister">
					<a class="getVerCodeBtn">获取验证码</a>
				</div>
				<div>
					<input class="loginBtn" type="button" value="登陆" />
				</div>

			</form>
		</div>

	</body>
	<script type="text/javascript" src="js/public.js"></script>
	<script type="text/javascript">
        var g_url = window.location.protocol+"//"+window.location.host+"/user/";

        function checkPhoneNum() {
            if ($('#phoneNum').val() == "") {
                alert("请输入正确的手机号！");
                return false;
            }

            return true;
        }

        function checkVerCode() {
            if ($('#verCode').val() == "") {
                alert("请输入验证码！");
                return false;
            }

            return true;
        }


		//获取验证码
        $(".getVerCodeBtn").on("click", function() {

            if($(this).text() != "获取验证码") {
                return;
            }

            if (checkPhoneNum() == false) {
                alert("请输入正确的手机号！");
                return;
            }

            $(this).text("60s");
            var athis = $(this);
            var i = 60;
            var athime = setInterval(function() {
                if(i != 0) {
                    i--;
                    athis.text(i+"s");
                } else {
                    athis.text("获取验证码");
                    clearInterval(athime);
                }

            }, 1000);


            var query = {
                type: "MSG_TYPE_USER_GET_VERCODE",
                phoneNumber: $('#phoneNum').val()
            };

            priAjaxPost("/user/", query,
                    function(data){
                        if (data.ret == 0) {
                            alert("发送验证码成功!");
                        }
                    },
                    function() {
                        alert("获取验证码失败!");
                    });

        });

        $(".loginBtn").on("click", function() {
            if (checkPhoneNum() == false) {
                return;
            }
            if (checkVerCode() == false) {
                return;
            }

            var query = {
                type: "MSG_TYPE_USER_VERCODE_LOGIN",
                phoneNumber: $('#phoneNum').val(),
                verCode: $('#verCode').val(),
                loginType: $('#loginType option:selected').val()
            };

            priAjaxPost("/user/", query,
                    function(data){
                        alert(JSON.stringify(data));
                        if (data.ret == 0) {
                            var userInfo = {
                            };
                            userInfo.uid = data.uid;
                            userInfo.role = 4;
                            window.localStorage.setItem('userInfo', JSON.stringify(userInfo));
                            $(window).attr('location', window.location.protocol+"//"+window.location.host+"/");
                        } else {
                            alert(data.msg);
                        }
                    },
                    function() {
                        alert("登陆失败!");
                    });
        });
	</script>
</html>
