 <!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<link rel="stylesheet" href="css/all.css"/>
		<link rel="stylesheet" href="css/public.css" />
		<link rel="stylesheet" href="css/router_currentsource.css" />
		<script type="text/javascript" src="js/jquery.1.9.1.js" ></script>
		<script type="text/javascript" src="js/vue.js"></script>
		<title id="name" fileNam="plugin">插件管理</title>
	</head>
	<body>
		<!--记录数据-->
		<div id="fileName" fileNam="router_historyresourceSmal"></div>
		<!--记录数据-->
		
		<div class="pluginContainer">
			<div class="pluginTitle"><a class="backBtn" >返回</a>路由器历史直播资源</div>
			
			<div class="table" style="height: 400px;margin-top: 30px;"></div>
         </div>
		
		<div class="pluginContainer" fileNam="plugin">


			<div style="padding:10px 10px 0 10px;font-size: 13px;color: #2dc3e8;">origin表示直接从直播平台获取。</div>

			<div class="tableContainer" style="margin-top: 15px;" id="vueApp">
			<table id="table">
				<tr>
					<!--<th>平台名称</th>
					<th>文件名</th>
					<th>直接获取的流的数目</th>
					<th>p2p转发的流的数目</th>
					<th>直接获取的字节数</th>
					<th>p2p转发的字节数</th>
					<th>转发情况</th>-->
					<th>ResourceId</th>
					<th>直播来源</th>
					<th>转发给</th>
					<th>开始时间</th>
					<th>结束时间</th>
					<th>字节数</th>
				</tr>
				<tr id="cell" class="cell" v-for="dic in message.values">
					<td v-for="value in dic">
					<!-- {{ value | make}} -->{{value}}</td>
					<!--<td ><a class="pluginVersion blueBut" href="router_retransmission.html">详情</a></td>-->
				</tr>
			</table>
			</div>
			<div style="height: 15px;"></div>
			
		</div>
		

	</body>
<script type="text/javascript" src="js/public.js" ></script>
<script type="text/javascript" src="js/echarts.js" ></script>
<!--<script type="text/javascript" src="js/netWokr.js" ></script>-->
<script>

var deviceId = window.localStorage.deviceId;
var vm = new Vue({
  el: '#vueApp',
  data: {
    message:{values:[{"deviceId":"2","resourceId":"6","src":"origin2"},{"deviceId":"1","resourceId":"6","src":"origin"},{"deviceId":"6","resourceId":"5","src":"origin"}]},
    headArr:[],
  },
  filters:{
  	make:function(value){
  		var str = "";
  		if (value instanceof Array) {

  			for(var i = 0 ; i < value.length; i++){
  				//判断是否是当前路由器 是当前路由器就不显示
  				if(value[i] == deviceId || value[i] == deviceId.toString()){
  					continue;
  				}
  				if(str == "") {
  					
  					str = value[i];
  					}else{
  						str = str +","+value[i];
  					}
  			}
  			
			if(str == ""){
				str = "N/A";
			}

  			return str;
  		}else{
  			return value;
  		}
  		
  	}
  }
  
});



myajax(7,"post",{"deviceId":deviceId},detaiCallBack);

function detaiCallBack(data1){

	//  vm.message = data1;
	//  var resourceIdArr = [];
 //     var data = {};

 // for(var i= 0; i< vm.message.values.length; i++){

 // 	var thisId = vm.message.values[i].resourceId;
 	
 // 	var has =  $.inArray(thisId, resourceIdArr);

 // 	if(has == -1){
 // 		resourceIdArr.push(thisId);
 		
 // 	   data[thisId] = {"resourceId":thisId,src:[vm.message.values[i].src],deviceId:[vm.message.values[i].deviceId]};
 // 	   // data[thisId] = {"resourceId":thisId,src:[vm.message.values[i].src],deviceId:[vm.message.values[i].deviceId],firsttime:vm.message.values[i].firstTime,lastTime:vm.message.values[i].lastTime,totalBytes:vm.message.values[i].totalBytes};
 	 
 // 	}else{
 	  
 // 	  var arr1 = data[thisId].deviceId;
 // 	  var arr2 = data[thisId].src;
 // 	  var a1 = vm.message.values[i].deviceId;
 // 	  var a2 = vm.message.values[i].src;
 // 		var hasDeviceID = $.inArray(a1,arr1);
 // 		var hasSrc = $.inArray(a2,arr2);
 		
 		
 	
 		
 // 		if(hasDeviceID == -1){
 		
 // 			data[thisId].deviceId.push(vm.message.values[i].deviceId);
 			
 // 		}
 // 		if(hasSrc == -1){
 			
 // 			data[thisId].src.push(vm.message.values[i].src);
 // 		}
 // 	}
 // }
 


 vm.message = data1;
}//callback



 

//处理数据
function formateData(data1,bytes) {
	var arr = data1.values;
	var timeArr = [];
	var bytesArr = [];

	for(var i = 0; i < arr.length; i++) {
		if(bytes == 1){
			bytesArr.push(arr[i].totalBytes);
			timeArr.push(arr[i].time.slice(0, 7));
		}
	
		
	}
	
	return {
		timeArr: timeArr,
		bytesArr: bytesArr
	};
}
/*----------------------------------------------------------------*/
var isconnected = 1;//是否联网状态
if(isconnected) {
	myajax(10, "post", {deviceId:deviceId}, allBytesCallback);
	
} else {

	var data = {
		values: [{
			totalBytes: 100100000,
			time: "2016-05-21 20:31:00"
		}, {
			totalBytes:2000000000,
			time: "2016-06-21 20:31:00"
		}, {
			totalBytes:1000000000,
			time: "2016-07-21 20:31:00"
		}, {
			totalBytes:1000000000,
			time: "2016-08-21 20:31:00"
		}]
	};
	
	
	allBytesCallback(data);

}



function allBytesCallback(data1) {
	
var data1 = formateData(data1,1);//处理数据


	require.config({
		paths: {
			echarts: 'echarts/build/dist'
		}
	});

	// 使用
	require(
		[
			'echarts',
			'echarts/chart/line', // 使用柱状图就加载bar模块，按需加载
			'echarts/chart/bar'
		],
		function(ec) {
			// 基于准备好的dom，初始化echarts图表
			var myChart = ec.init(document.getElementsByClassName('table')[0]);

			var option = {
				grid:{
					x:150
				},
				title: {
					text: '路由器每月转发流量',
					subtext: ''
				},
				tooltip: {
					trigger: 'axis'
				},
				legend: {
					data: ['转发字节']
				},
				toolbox: {
					show: true,
					feature: {
						mark: {
							show: true
						},
						dataView: {
							show: true,
							readOnly: false
						},
						magicType: {
							show: true,
							type: ['line', 'bar']
						},
						restore: {
							show: true
						},
						saveAsImage: {
							show: true
						}
					}
				},
				calculable: true,
				xAxis: [{
					type: 'category',
					boundaryGap: false,
					data: data1.timeArr
				}],
				yAxis: [{
					type: 'value',
					axisLabel: {
						formatter: '{value} Byte'
					}
				}],
				series: [{
					name: '转发字节',
					type: 'line',
					data: data1.bytesArr,
//					markPoint: {
//						data: [{
//								type: 'max',
//								name: '最大值'
//							},
//							{
//								type: 'min',
//								name: '最小值'
//							}
//						]
//					},
//					markLine: {
//						data: [{
//							type: 'average',
//							name: '平均值'
//						}]
//					}
				}]
			};

			// 为echarts对象加载数据 
			myChart.setOption(option);
		}
	);

} //allBytesCallback



 
 </script>
</html>
